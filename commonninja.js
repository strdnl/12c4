!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("commonninja-js-sdk",[],t):"object"==typeof exports?exports["commonninja-js-sdk"]=t():e["commonninja-js-sdk"]=t()}("undefined"!=typeof self?self:this,function(){return function(e){function t(i){if(n[i])return n[i].exports;var o=n[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,i){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=0)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),o=function(){function e(e){var t=this;this.window=e,this.minPluginHeight=100,this.eventTypes={COMMONNINJA_PLUGIN_LOADED:"COMMONNINJA_PLUGIN_LOADED",COMMONNINJA_DIMENSIONS_UPDATE:"COMMONNINJA_DIMENSIONS_UPDATE",COMMONNINJA_PARENT_WINDOW_SCROLL:"COMMONNINJA_PARENT_WINDOW_SCROLL"},document.addEventListener("DOMContentLoaded",function(){t.init()},!1),this.init()}return e.prototype.init=function(){if(this.findPlugins(),this.installPlugins(),!this.initiatedOnce)return this.initiatedOnce=!0,this.addEventListeners(),void this.listenToMessages()},e.prototype.findPlugins=function(){var e=Array.from(document.querySelectorAll(".commonninja_component")),t=[];e.forEach(function(e,n){var i={wrapperElm:e,iframeElm:null,id:e.getAttribute("comp-id"),type:e.getAttribute("comp-type"),reportedEvents:[]};t.push(i)}),this.plugins=t},e.prototype.installPlugins=function(){var e=this;if(this.plugins.length){var t="width: 100%; min-height: "+this.minPluginHeight+"px; border: none; margin: 0; padding: 0; background: none;";this.plugins=this.plugins.map(function(n){var o=e.pluginBaseUrl||i.PluginBaseUrl[n.type];return n.wrapperElm.innerHTML='<iframe\n        style="'+t+'"\n        frameborder="0"\n        src="'+o+"/"+i.PluginViewerPath[n.type]+"/"+n.id+'"\n        allowfullscreen\n      >\n      </iframe>',n.iframeElm=n.wrapperElm.querySelector("iframe"),n})}},e.prototype.updatePluginHeight=function(e,t){this.plugins.forEach(function(n){if(n.id===e){var i=n.wrapperElm.querySelector("iframe");i.style.height=t+"px",i.style.minHeight=t+"px"}})},e.prototype.isInViewport=function(e){return e.top+e.height/5<=(window.innerHeight||document.documentElement.clientHeight)&&e.top>=0&&e.left>=0&&e.right<=(window.innerWidth||document.documentElement.clientWidth)},e.prototype.reportViewIfNeeded=function(e){if(e){var t=e.iframeElm.getBoundingClientRect();return e.reportedEvents.indexOf(i.ClientEvent.IMPRESSION)>=0&&this.isInViewport(t)&&e.reportedEvents.indexOf(i.ClientEvent.VIEW)<0&&this.reportEvent(e.id,i.ClientEvent.VIEW),t}},e.prototype.onScroll=function(){var e=this;this.plugins=this.plugins.map(function(t){var n=e.reportViewIfNeeded(t);if(n)return e.sendMessage(t.iframeElm,{type:e.eventTypes.COMMONNINJA_PARENT_WINDOW_SCROLL,fromTop:n.top,compId:t.id}),t})},e.prototype.addEventListeners=function(){document.addEventListener("scroll",this.onScroll.bind(this)),this.onScroll()},e.prototype.sendMessage=function(e,t){e.contentWindow.postMessage(JSON.stringify(t),"*")},e.prototype.listenToMessages=function(){var e=this,t=window.addEventListener?"addEventListener":"attachEvent";(0,window[t])("attachEvent"===t?"onmessage":"message",function(t){if(t.data){var n={};try{n="string"==typeof t.data?JSON.parse(t.data):t.data}catch(e){}if(!n.compId)return;switch(n.type){case e.eventTypes.COMMONNINJA_DIMENSIONS_UPDATE:if(!n.height||e.minPluginHeight>n.height)return;e.updatePluginHeight(n.compId,n.height);break;case e.eventTypes.COMMONNINJA_PLUGIN_LOADED:e.reportEvent(n.compId,i.ClientEvent.IMPRESSION),e.reportViewIfNeeded(e.plugins.filter(function(e){return e.id===n.compId})[0])}}},!1)},e.prototype.makeRequest=function(e,t){var n=new XMLHttpRequest;n.open("GET",e),n.send(),n.onreadystatechange=function(){4===this.readyState&&200===this.status&&t&&t(n.responseText)}},e.prototype.reportEvent=function(e,t){this.plugins=this.plugins.map(function(n){return n.id===e&&n.reportedEvents.push(t),n});var n=this.commonninjaBaseUrl||"https://www.commoninja.com";this.makeRequest(n+"/api/event/report/"+e+"?type="+t)},e}();if(void 0===window.CommonNinja){var r=new o(window||new Window);window.CommonNinja=r}t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,o,r;!function(e){e.BRACKET="bracket",e.COMPARISON_TABLE="comparison_table",e.PRICING_TABLE="pricing_table",e.CHART="chart",e.FEED="feed"}(r=t.PluginType||(t.PluginType={})),t.PluginBaseUrl=(i={},i[r.BRACKET]="https://brackets.commoninja.com",i[r.COMPARISON_TABLE]="https://tables.commoninja.com",i[r.PRICING_TABLE]="https://pricingtables.commoninja.com",i[r.CHART]="https://charts.commoninja.com",i[r.FEED]="https://feeds.commoninja.com",i),t.PluginViewerPath=(o={},o[r.BRACKET]="api/viewer",o[r.COMPARISON_TABLE]="api/v2/viewer",o[r.PRICING_TABLE]="api/viewer",o[r.CHART]="api/viewer",o[r.FEED]="api/viewer",o);!function(e){e.IMPRESSION="IMPRESSION",e.VIEW="VIEW"}(t.ClientEvent||(t.ClientEvent={}))}]).default});